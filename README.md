# Trading Signal Bot

ะะฒัะพะผะฐัะธะทะธัะพะฒะฐะฝะฝัะน ะฑะพั ะดะปั ะพะฑะฝะฐััะถะตะฝะธั ัะพัะณะพะฒัั ัะธะณะฝะฐะปะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ ะฟะธะบะพะฒะพะน ะดะตัะตะบัะธะธ ะธ ัะฒะตะดะพะผะปะตะฝะธะน ัะตัะตะท Telegram.

## ๐ ะัััััะน ััะฐัั

### ๐ณ Docker (ะะตะบะพะผะตะฝะดัะตััั ะดะปั ะฟัะพะดะฐะบัะตะฝะฐ)

**ะกะฐะผัะน ะฟัะพััะพะน ัะฟะพัะพะฑ ะทะฐะฟััะบะฐ ะฝะฐ ะปัะฑะพะน ัะธััะตะผะต:**

```bash
# 1. ะกะพะทะดะฐะนัะต local_settings.py ั ะฒะฐัะธะผะธ ะฝะฐัััะพะนะบะฐะผะธ
# 2. ะะฐะฟัััะธัะต ะพะดะฝะพะน ะบะพะผะฐะฝะดะพะน
chmod +x run.sh
./run.sh run
```

**ะฃะฟัะฐะฒะปะตะฝะธะต ะบะพะฝัะตะนะฝะตัะพะผ:**
```bash
./run.sh logs     # ะัะพัะผะพัั ะปะพะณะพะฒ
./run.sh status   # ะกัะฐััั ะบะพะฝัะตะนะฝะตัะฐ
./run.sh restart  # ะะตัะตะทะฐะฟััะบ
./run.sh shell    # ะะพัััะฟ ะบ shell ะบะพะฝัะตะนะฝะตัะฐ
./run.sh stop     # ะััะฐะฝะพะฒะบะฐ
./run.sh clean    # ะะพะปะฝะฐั ะพัะธััะบะฐ
```

### ๐ป ะะพะบะฐะปัะฝะฐั ัััะฐะฝะพะฒะบะฐ (ะดะปั ัะฐะทัะฐะฑะพัะบะธ)

```bash
# ะะปะพะฝะธััะนัะต ัะตะฟะพะทะธัะพัะธะน ะธ ะฟะตัะตะนะดะธัะต ะฒ ะดะธัะตะบัะพัะธั ะฟัะพะตะบัะฐ
cd peak_detection_dev

# ะะฐะฟัััะธัะต ะฐะฒัะพะผะฐัะธัะตัะบัั ัััะฐะฝะพะฒะบั
python setup.py
```

ะกะบัะธะฟั ัััะฐะฝะพะฒะบะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- ะกะพะทะดะฐัั ะฒะธัััะฐะปัะฝัั ััะตะดั ะฒ `bot_service/.venv`
- ะฃััะฐะฝะพะฒะธั ะฒัะต ะทะฐะฒะธัะธะผะพััะธ
- ะัะพะฒะตัะธั ะบะพะฝัะธะณััะฐัะธั
- ะัะพัะตััะธััะตั ะธะผะฟะพััั

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### 1. ะกะพะทะดะฐะฝะธะต local_settings.py

ะกะพะทะดะฐะนัะต ัะฐะนะป `local_settings.py` ะฒ ะบะพัะฝะตะฒะพะน ะดะธัะตะบัะพัะธะธ:

```python
# Database credentials
DB_HOST = 'your_host'
DB_PORT = 'your_port'
DB_DATABASE = 'your_database'
DB_USER = 'your_user'
DB_PASSWORD = 'your_password'

# Telegram bot credentials
TELEGRAM_BOT_TOKEN = 'your_bot_token'
TELEGRAM_CHAT_ID = 'your_chat_id'

# Bot settings
MODE = 'real'  # or 'simulate'
REAL_DETECT_HOURS = 25
VIZ_WINDOW_DAYS = 7
TIMEZONE = 'Europe/Moscow'
```

### 2. ะะฐัััะพะนะบะฐ ะฟะพัะพะณะพะฒัั ะทะฝะฐัะตะฝะธะน

ะััะตะดะฐะบัะธััะนัะต `strategy_thresholds.json`:

```json
{
  "strategy_name_1": -18.0,
  "strategy_name_2": -25.0
}
```

### 3. ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ

```bash
# ะัะพััะพ ะทะฐะฟัััะธัะต ะธะท ะบะพัะฝะตะฒะพะน ะดะธัะตะบัะพัะธะธ
python run_bot.py
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
peak_detection_dev/
โโโ run_bot.py              # ๐ ะะปะฐะฒะฝัะน ัะบัะธะฟั ะทะฐะฟััะบะฐ
โโโ setup.py                # ๐ง ะกะบัะธะฟั ัััะฐะฝะพะฒะบะธ
โโโ config.py               # โ๏ธ ะัะฝะพะฒะฝะฐั ะบะพะฝัะธะณััะฐัะธั
โโโ local_settings.py       # ๐ ะะพะบะฐะปัะฝัะต ะฝะฐัััะพะนะบะธ (ัะพะทะดะฐัั)
โโโ strategy_thresholds.json # ๐ ะะพัะพะณะพะฒัะต ะทะฝะฐัะตะฝะธั ัััะฐัะตะณะธะน
โโโ calculate_peak.py       # ๐ ะะปะณะพัะธัะผ ะฟะธะบะพะฒะพะน ะดะตัะตะบัะธะธ
โโโ strategy_data_processor.py # ๐๏ธ ะะฑัะฐะฑะพัะบะฐ ะดะฐะฝะฝัั ะะ
โโโ Dockerfile              # ๐ณ Docker ะพะฑัะฐะท
โโโ entrypoint.sh           # ๐ง Docker entrypoint
โโโ run.sh                  # ๐ Docker ัะฟัะฐะฒะปะตะฝะธะต
โโโ .dockerignore           # ๐ซ Docker ะธัะบะปััะตะฝะธั
โโโ bot_service/            # ๐ค ะกะตัะฒะธั ะฑะพัะฐ
โ   โโโ .venv/             # ๐ ะะธัััะฐะปัะฝะฐั ััะตะดะฐ
โ   โโโ run_bot.py         # ๐ค ะัะฝะพะฒะฝะพะน ะบะพะด ะฑะพัะฐ
โ   โโโ requirements.txt   # ๐ฆ ะะฐะฒะธัะธะผะพััะธ
โ   โโโ services/          # ๐๏ธ ะกะตัะฒะธัั ะฑะพัะฐ
โ   โ   โโโ data_pipeline.py
โ   โ   โโโ notifier.py
โ   โ   โโโ state_store.py
โ   โ   โโโ visualization_service.py
โ   โโโ state/             # ๐พ ะกะพััะพัะฝะธะต ะฑะพัะฐ
โโโ README.md              # ๐ ะญัะพั ัะฐะนะป
```

## ๐ง ะะพะผะฐะฝะดั ะฑะพัะฐ

- `/run_now` - ะะฐะฟัััะธัั ัะธะบะป ะพะฑะฝะฐััะถะตะฝะธั ัะธะณะฝะฐะปะพะฒ ะฒัััะฝัั
- `/simulate_at <strategy> <YYYY-MM-DD HH:MM>` - ะกะธะผัะปััะธั ัะธะณะฝะฐะปะฐ ะฒ ะบะพะฝะบัะตัะฝะพะต ะฒัะตะผั
- `/all_viz` - ะกะพะทะดะฐัั ะฒะธะทัะฐะปะธะทะฐัะธะธ ะดะปั ะฒัะตั ัััะฐัะตะณะธะน

## ๐ณ Docker Deployment

### ะกะธััะตะผะฝัะต ััะตะฑะพะฒะฐะฝะธั
- Docker ะธ Docker Compose
- Linux/macOS/Windows ั WSL2
- ะะธะฝะธะผัะผ 1GB RAM
- ะะพัััะฟ ะบ MySQL ะฑะฐะทะต ะดะฐะฝะฝัั

### ะัะพะฑะตะฝะฝะพััะธ Docker ะฒะตััะธะธ
- **ะะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตะทะฐะฟััะบ** ะฟัะธ ัะฑะพัั
- **ะะพัะฐัะธั ะปะพะณะพะฒ** (100MB, 3 ัะฐะนะปะฐ)
- **ะะทะพะปััะธั ะทะฐะฒะธัะธะผะพััะตะน** ะพั ัะพัั-ัะธััะตะผั
- **ะัะฐะฒะธะปัะฝะฐั ะฝะฐัััะพะนะบะฐ timezone** (Europe/Moscow)
- **ะะตะทะพะฟะฐัะฝะพััั**: credentials ะผะพะฝัะธัััััั ะพัะดะตะปัะฝะพ

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

- `MODE` - ะะตะถะธะผ ัะฐะฑะพัั: `real` ะธะปะธ `simulate`
- `REAL_DETECT_HOURS` - ะงะฐัั ะดะปั ะพะฑะฝะฐััะถะตะฝะธั ะฒ ัะตะฐะปัะฝะพะผ ัะตะถะธะผะต (ะฟะพ ัะผะพะปัะฐะฝะธั: 25)
- `VIZ_WINDOW_DAYS` - ะะฝะธ ะดะปั ะฒะธะทัะฐะปะธะทะฐัะธะธ (ะฟะพ ัะผะพะปัะฐะฝะธั: 7)
- `TIMEZONE` - ะงะฐัะพะฒะพะน ะฟะพัั (ะฟะพ ัะผะพะปัะฐะฝะธั: Europe/Moscow)

### ะะฐัะฟะธัะฐะฝะธะต

ะะพั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะทะฐะฟััะบะฐะตััั ะบะฐะถะดัะน ัะฐั ะฒ ะฝะฐัะฐะปะต ัะฐัะฐ (XX:00) ะธัะฟะพะปัะทัั APScheduler ั cron-ััะธะณะณะตัะพะผ.

## ๐๏ธ ะะฐะทะฐ ะดะฐะฝะฝัั

ะกะธััะตะผะฐ ะธัะฟะพะปัะทัะตั **ะฐัะธะฝััะพะฝะฝัะต** ะทะฐะฟัะพัั ะบ ะฑะฐะทะต ะดะฐะฝะฝัั ั ะฟะพะผะพััั:
- SQLAlchemy async engine
- asyncmy ะดัะฐะนะฒะตั ะดะปั MySQL
- ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะต ะทะฐะฟัะพัั ะดะปั ะปัััะตะน ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

## ๐ ะะปะณะพัะธัะผ ะพะฑะฝะฐััะถะตะฝะธั

1. **ะกะฑะพั ะดะฐะฝะฝัั**: ะะพะปััะตะฝะธะต ะฟะพัะปะตะดะฝะธั N ัะฐัะพะฒ ะดะฐะฝะฝัั PnL
2. **ะกะณะปะฐะถะธะฒะฐะฝะธะต**: ะัะธะผะตะฝะตะฝะธะต ัะธะปัััะฐ ะกะฐะฒะธัะบะพะณะพ-ะะพะปะฐั (ะพะบะฝะพ=25, ะฟะพะปะธะฝะพะผ=1)
3. **ะะธะบะพะฒะฐั ะดะตัะตะบัะธั**: ะะฝะฐะปะธะท ะฟะตัะฒะพะน ะธ ะฒัะพัะพะน ะฟัะพะธะทะฒะพะดะฝัั
4. **ะะพัะพะณะพะฒัะต ะทะฝะฐัะตะฝะธั**: ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะฐะฑัะพะปััะฝัั ะฟะพัะพะณะพะฒ ะธะปะธ ะดะธะฝะฐะผะธัะตัะบะธั ะบะฒะฐะฝัะธะปะตะน
5. **Cooldown ัะธััะตะผะฐ**: 24ั ะฑะปะพะบะธัะพะฒะบะฐ + 24ั ะฒะพัััะฐะฝะพะฒะปะตะฝะธะต
6. **ะฃะฒะตะดะพะผะปะตะฝะธั**: ะัะฟัะฐะฒะบะฐ ัะธะณะฝะฐะปะพะฒ ัะตัะตะท Telegram ั ะณัะฐัะธะบะฐะผะธ

## ๐ ะัะปะฐะดะบะฐ ะธ ะผะพะฝะธัะพัะธะฝะณ

### Docker ะปะพะณะธ
```bash
./run.sh logs        # ะัะพัะผะพัั ะปะพะณะพะฒ
./run.sh shell       # ะะพัััะฟ ะบ ะบะพะฝัะตะนะฝะตัั
docker logs trading-bot -f  # ะกะปะตะดะธัั ะทะฐ ะปะพะณะฐะผะธ ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ
```

### ะะพะบะฐะปัะฝะฐั ะพัะปะฐะดะบะฐ
```bash
python -c "from config import load_settings; print('Config OK')"
```

### ะัะพะฒะตัะบะฐ ัะพััะพัะฝะธั
```bash
./run.sh status      # ะกัะฐััั ะบะพะฝัะตะนะฝะตัะฐ
docker ps -f name=trading-bot  # ะะตัะฐะปัะฝะฐั ะธะฝัะพัะผะฐัะธั
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

ะะพั ะปะพะณะธััะตั:
- ะฃัะฟะตัะฝัะต ะฟะพะดะบะปััะตะฝะธั ะบ ะะ
- ะะฑะฝะฐััะถะตะฝะฝัะต ัะธะณะฝะฐะปั ะธ ะธั ะฟะฐัะฐะผะตััั
- ะัะธะฑะบะธ ะพะฑัะฐะฑะพัะบะธ ะดะฐะฝะฝัั
- ะกัะฐัะธััะธะบั ะฟะพ ัััะฐัะตะณะธัะผ
- ะัะฟัะฐะฒะปะตะฝะฝัะต ัะฒะตะดะพะผะปะตะฝะธั
- ะัะธะฑะบะธ ะฒัะฟะพะปะฝะตะฝะธั ะธ ะธั ะฟัะธัะธะฝั

## ๐จ Troubleshooting

### ะงะฐัััะต ะฟัะพะฑะปะตะผั

**Docker ะบะพะฝัะตะนะฝะตั ะฝะต ะทะฐะฟััะบะฐะตััั:**
```bash
# ะัะพะฒะตัััะต ะปะพะณะธ
./run.sh logs

# ะัะพะฒะตัััะต ะบะพะฝัะธะณััะฐัะธั
./run.sh shell
cat local_settings.py
```

**ะะตั ะฟะพะดะบะปััะตะฝะธั ะบ ะะ:**
- ะัะพะฒะตัััะต ะฟะฐัะฐะผะตััั ะฟะพะดะบะปััะตะฝะธั ะฒ `local_settings.py`
- ะฃะฑะตะดะธัะตัั, ััะพ ะะ ะดะพัััะฟะฝะฐ ะธะท Docker ะบะพะฝัะตะนะฝะตัะฐ
- ะัะพะฒะตัััะต firewall ะฝะฐัััะพะนะบะธ

**Telegram ะฑะพั ะฝะต ะพัะฒะตัะฐะตั:**
- ะัะพะฒะตัััะต `TELEGRAM_BOT_TOKEN` ะธ `TELEGRAM_CHAT_ID`
- ะฃะฑะตะดะธัะตัั, ััะพ ะฑะพั ะดะพะฑะฐะฒะปะตะฝ ะฒ ัะฐั
- ะัะพะฒะตัััะต ะธะฝัะตัะฝะตั ัะพะตะดะธะฝะตะฝะธะต ะบะพะฝัะตะนะฝะตัะฐ

**ะะตั ัะธะณะฝะฐะปะพะฒ:**
- ะัะพะฒะตัััะต ะฟะพัะพะณะพะฒัะต ะทะฝะฐัะตะฝะธั ะฒ `strategy_thresholds.json`
- ะฃะฑะตะดะธัะตัั, ััะพ ะฒ ะะ ะตััั ัะฒะตะถะธะต ะดะฐะฝะฝัะต
- ะัะพะฒะตัััะต ัะตะถะธะผ ัะฐะฑะพัั (`MODE` ะฒ ะฝะฐัััะพะนะบะฐั)

### ะะพะปะตะทะฝัะต ะบะพะผะฐะฝะดั

```bash
# ะะตัะตะทะฐะฟััะบ ั ะฟะพะปะฝะพะน ะฟะตัะตัะฑะพัะบะพะน
./run.sh clean && ./run.sh run

# ะะพะฝะธัะพัะธะฝะณ ัะตััััะพะฒ
docker stats trading-bot

# ะญะบัะฟะพัั ะปะพะณะพะฒ
docker logs trading-bot > bot_logs.txt 2>&1
```

## ๐ ะะฑะฝะพะฒะปะตะฝะธั

ะะปั ะพะฑะฝะพะฒะปะตะฝะธั ะทะฐะฒะธัะธะผะพััะตะน:
```bash
cd bot_service
.venv\Scripts\Activate.ps1  # Windows
pip install -r requirements.txt --upgrade
```

## ๐ ะะพะณะธ

ะัะต ะปะพะณะธ ะฒัะฒะพะดัััั ะฒ ะบะพะฝัะพะปั. ะะปั ัะพััะฐะฝะตะฝะธั ะฒ ัะฐะนะป:
```bash
python run_bot.py > bot.log 2>&1
```

---

**๐ก ะกะพะฒะตั**: ะัะฟะพะปัะทัะนัะต `python setup.py` ะดะปั ะฟะตัะฒะพะฝะฐัะฐะปัะฝะพะน ะฝะฐัััะพะนะบะธ ะธ `python run_bot.py` ะดะปั ะทะฐะฟััะบะฐ ะฑะพัะฐ.
